import{u as L,r as u,k as v,c as l,b as a,d as o,f as M,n as S,t as b,w as N,l as c,v as y,m as V,F as $,g as E,h as Q,i as n}from"./index-Cz9aqF_s.js";import{u as Z}from"./bot-D3weyv_4.js";const U={class:"max-w-4xl mx-auto p-6 bg-gray-50 dark:bg-gray-900 min-h-screen"},j={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6"},I={key:0,class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},R={key:1,class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},W={class:"ml-3 text-sm font-normal"},_=["value"],O={class:"grid grid-cols-2 gap-4"},G=["disabled"],X={__name:"NewBot",setup(H){const P=Q(),z=Z();L();const d=u(!1),i=v({show:!1,type:"success",message:"",timeout:null}),w=(r,t)=>{i.timeout&&clearTimeout(i.timeout),i.show=!0,i.type=r,i.message=t,i.timeout=setTimeout(()=>{i.show=!1},3e3)},C=()=>{i.show=!1,i.timeout&&clearTimeout(i.timeout)},f=u([]),g=u(""),m=u(""),q=l(()=>f.value.filter(r=>r.symbol.toLowerCase().includes(g.value.toLowerCase()))),e=v({quotaCoin:"",baseCoin:"",startDepo:0,offsetBottom:.05,offsetTop:.5,ticksize:0}),B=async()=>{try{const t=await(await fetch("/binance")).json();f.value=t.symbols.map(s=>{const F=s.quoteAsset,D=s.baseAsset,x=s.filters.find(p=>p.filterType==="PRICE_FILTER"),h=s.filters.find(p=>p.filterType==="LOT_SIZE");return{symbol:s.symbol,tickSize:x?x.tickSize:null,stepSize:h?h.stepSize:null,baseAsset:F,quoteAsset:D}})}catch(r){console.error("Error fetching trading pairs:",r)}},T=()=>{const r=f.value.find(t=>t.symbol===m.value);r&&(console.log(r),e.tickSize=r.tickSize,e.baseCoin=r.baseAsset,e.quotaCoin=r.quoteAsset,e.stepSize=r.stepSize,e.digitQ=k(r.stepSize),e.digitPrice=k(r.tickSize))};B(),l(()=>!e.startDepo||!e.orderSize||!e.minPrice?0:(e.startDepo*e.orderSize/100/e.minPrice).toFixed(e.digitQ)),l(()=>!e.startDepo||!e.orderSize?0:(e.startDepo*e.orderSize/100).toFixed(e.digitQ)),l(()=>!e.minPrice||!e.offsetBottom?0:(e.minPrice*e.offsetBottom/100).toFixed(e.digitPrice)),l(()=>!e.minPrice||!e.offsetTop||!e.profitProc?0:(e.minPrice*(1+e.profitProc/100)*e.offsetTop/100).toFixed(e.digitPrice));function k(r){return r.includes(".")?r.split(".")[1].replace(/0+$/,"").length:0}const A=async()=>{d.value=!0;try{const r=Math.floor(Date.now()/1e3),s={botname:`${e.quotaCoin}${e.baseCoin}-${r}`,busy:!1,onoff:!1,settings:{quotacoin:e.quotaCoin,basecoin:e.baseCoin,startdepo:0,offsetbottom:e.offsetBottom,offsettop:e.offsetTop,digitprice:e.digitPrice,digitq:e.digitQ,stepsize:e.stepSize,ticksize:e.tickSize,exchange:"Binance"},finance:{startdepo:0,depo:0,quotanal:0,quotainorders:0,basenal:0,baseinorders:0,profityoday:0},sales:{today:[],days:[],all:[]},status:{currentprice:0,lastprice:-1,rezhim:"Стартовые настройки",updated:-1},tsl:{raschstopprice:0,curstop:0,curorderid:0,quantity:0,filledquantity:0,sold:!1,state:"0",busy:!1},openpos:{quantity:0}};await z.createBot(s),w("success","Бот успешно создан"),P.push("/")}catch(r){w("error","Ошибка при создании бота"),console.error("Failed to create bot:",r)}finally{d.value=!1}};return(r,t)=>(n(),a("div",U,[o("div",j,[t[11]||(t[11]=o("h2",{class:"text-2xl font-bold mb-6 dark:text-white"},"Создание нового бота",-1)),i.show?(n(),a("div",{key:0,class:S(`fixed top-4 right-4 flex items-center w-full max-w-xs p-4 mb-4 rounded-lg shadow ${i.type==="success"?"bg-green-100 dark:bg-green-800 text-green-600 dark:text-green-200":"bg-red-100 dark:bg-red-800 text-red-600 dark:text-red-200"}`),role:"alert"},[o("div",{class:S(`inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg ${i.type==="success"?"bg-green-200 dark:bg-green-600 text-green-600 dark:text-green-100":"bg-red-200 dark:bg-red-600 text-red-600 dark:text-red-100"}`)},[i.type==="success"?(n(),a("svg",I,t[4]||(t[4]=[o("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"},null,-1)]))):(n(),a("svg",R,t[5]||(t[5]=[o("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"},null,-1)])))],2),o("div",W,b(i.message),1),o("button",{onClick:C,type:"button",class:"ml-auto -mx-1.5 -my-1.5 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 inline-flex h-8 w-8 text-gray-500 hover:text-gray-900 hover:bg-gray-100 dark:hover:text-white dark:hover:bg-gray-700","data-dismiss-target":"#toast-success","aria-label":"Close"},t[6]||(t[6]=[o("span",{class:"sr-only"},"Закрыть",-1),o("svg",{class:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[o("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1)]))],2)):M("",!0),o("form",{onSubmit:N(A,["prevent"]),class:"space-y-6"},[o("div",null,[t[8]||(t[8]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Выберите торговую пару *",-1)),c(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),placeholder:"Поиск по символу",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"},null,512),[[y,g.value]]),c(o("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),onChange:T,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[t[7]||(t[7]=o("option",{value:"",disabled:""},"Выберите торговую пару",-1)),(n(!0),a($,null,E(q.value,s=>(n(),a("option",{key:s.symbol,value:s.symbol},b(s.symbol),9,_))),128))],544),[[V,m.value]])]),o("div",O,[o("div",null,[t[9]||(t[9]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Отступ снизу, % *",-1)),c(o("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>e.offsetBottom=s),required:"",min:"0",step:"0.001",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[y,e.offsetBottom]])]),o("div",null,[t[10]||(t[10]=o("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Отступ сверху, % *",-1)),c(o("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>e.offsetTop=s),required:"",min:"0",step:"0.001",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[y,e.offsetTop]])])]),o("button",{type:"submit",disabled:d.value,class:"w-full px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-700 dark:hover:bg-blue-600"},b(d.value?"Создание...":"Создать бота"),9,G)],32)])]))}};export{X as default};
